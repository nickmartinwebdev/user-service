# Security Configuration Template for User Service
# Copy this file to .env and configure the values for your environment

# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================
DATABASE_URL=postgresql://username:password@localhost:5432/user_service

# =============================================================================
# JWT CONFIGURATION
# =============================================================================
JWT_ACCESS_SECRET=your_super_secure_access_secret_key_here_minimum_32_chars
JWT_REFRESH_SECRET=your_super_secure_refresh_secret_key_here_minimum_32_chars
JWT_ACCESS_EXPIRES_HOURS=1
JWT_REFRESH_EXPIRES_DAYS=30
JWT_ISSUER=user-service
JWT_AUDIENCE=user-service-api

# =============================================================================
# RATE LIMITING CONFIGURATION
# =============================================================================
# Enable/disable rate limiting
AUTH_RATE_LIMIT_ENABLED=true

# Rate limit storage backend: database, redis, or memory (memory for testing only)
AUTH_RATE_LIMIT_STORE=database

# Redis URL (required if using redis store)
# REDIS_URL=redis://localhost:6379

# Email signup rate limits
RATE_LIMIT_EMAIL_SIGNUP_MAX=5
RATE_LIMIT_EMAIL_SIGNUP_WINDOW=60
RATE_LIMIT_EMAIL_SIGNUP_LOCKOUT=60

# Email verification rate limits
RATE_LIMIT_EMAIL_VERIFICATION_MAX=5
RATE_LIMIT_EMAIL_VERIFICATION_WINDOW=15
RATE_LIMIT_EMAIL_VERIFICATION_LOCKOUT=30

# OTP request rate limits
RATE_LIMIT_OTP_REQUEST_MAX=3
RATE_LIMIT_OTP_REQUEST_WINDOW=60
RATE_LIMIT_OTP_REQUEST_LOCKOUT=120

# OTP verification rate limits
RATE_LIMIT_OTP_VERIFY_MAX=5
RATE_LIMIT_OTP_VERIFY_WINDOW=15
RATE_LIMIT_OTP_VERIFY_LOCKOUT=30

# Passkey authentication rate limits
RATE_LIMIT_PASSKEY_MAX=10
RATE_LIMIT_PASSKEY_WINDOW=60

# OAuth authentication rate limits
RATE_LIMIT_OAUTH_MAX=10
RATE_LIMIT_OAUTH_WINDOW=60

# Global IP rate limits
RATE_LIMIT_GLOBAL_IP_MAX=50
RATE_LIMIT_GLOBAL_IP_WINDOW=60
RATE_LIMIT_GLOBAL_IP_LOCKOUT=60

# =============================================================================
# AUDIT LOGGING CONFIGURATION
# =============================================================================
# Enable/disable audit logging
AUTH_AUDIT_LOGGING=true

# Log retention period in days
AUTH_AUDIT_RETENTION_DAYS=90

# Enable async logging for better performance
AUTH_AUDIT_ASYNC=true

# Log successful authentication attempts
AUTH_AUDIT_LOG_SUCCESSES=true

# Log failed authentication attempts
AUTH_AUDIT_LOG_FAILURES=true

# Include IP addresses in logs
AUTH_AUDIT_INCLUDE_IP=true

# Include user agent strings in logs
AUTH_AUDIT_INCLUDE_USER_AGENT=true

# =============================================================================
# AUTHENTICATION SECURITY CONFIGURATION
# =============================================================================
# Require HTTPS for all authentication endpoints
AUTH_REQUIRE_HTTPS=true

# Enable CSRF protection
AUTH_CSRF_PROTECTION=true

# Secure cookie settings
AUTH_SECURE_COOKIES=true

# Reject any password-related fields (critical for passwordless auth)
AUTH_REJECT_PASSWORD_FIELDS=true

# =============================================================================
# SECURITY HEADERS CONFIGURATION
# =============================================================================
# Content Security Policy
CSP_ENABLED=true
CSP_DIRECTIVE=default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'

# X-Frame-Options
X_FRAME_OPTIONS_ENABLED=true

# X-Content-Type-Options
X_CONTENT_TYPE_OPTIONS_ENABLED=true

# Referrer-Policy
REFERRER_POLICY_ENABLED=true

# Permissions-Policy
PERMISSIONS_POLICY_ENABLED=true

# HTTP Strict Transport Security (HSTS)
HSTS_ENABLED=true
HSTS_MAX_AGE=31536000

# =============================================================================
# SESSION SECURITY CONFIGURATION
# =============================================================================
# Session timeout in minutes
SESSION_TIMEOUT_MINUTES=60

# Maximum concurrent sessions per user
MAX_CONCURRENT_SESSIONS=5

# Enable session fixation protection
SESSION_FIXATION_PROTECTION=true

# Regenerate session ID on authentication
SESSION_REGENERATE_ON_AUTH=true

# =============================================================================
# MONITORING AND ALERTING CONFIGURATION
# =============================================================================
# Enable security event monitoring
AUTH_SECURITY_ALERTS_ENABLED=true

# Threshold for suspicious activity detection
AUTH_SUSPICIOUS_ACTIVITY_THRESHOLD=10

# Alert on password attempts (critical for passwordless auth)
AUTH_ALERT_ON_PASSWORD_ATTEMPTS=true

# =============================================================================
# SERVER CONFIGURATION
# =============================================================================
SERVER_HOST=0.0.0.0
SERVER_PORT=3000
LOG_LEVEL=info

# CORS origins (comma-separated, use * for development only)
CORS_ORIGINS=https://yourdomain.com,https://app.yourdomain.com

# Request timeout in seconds
REQUEST_TIMEOUT_SECONDS=30

# Maximum request size in bytes (1MB)
MAX_REQUEST_SIZE=1048576

# =============================================================================
# DATABASE CONNECTION CONFIGURATION
# =============================================================================
DB_MAX_CONNECTIONS=10
DB_MIN_CONNECTIONS=1
DB_CONNECT_TIMEOUT=10
DB_IDLE_TIMEOUT=600
DB_MAX_LIFETIME=3600

# =============================================================================
# EMAIL SERVICE CONFIGURATION (Optional)
# =============================================================================
# SMTP configuration for email services
# SMTP_HOST=smtp.yourmailprovider.com
# SMTP_PORT=587
# SMTP_USERNAME=your_smtp_username
# SMTP_PASSWORD=your_smtp_password
# SMTP_USE_TLS=true
# SMTP_FROM_NAME=Your App Name
# SMTP_FROM_EMAIL=noreply@yourdomain.com
# EMAIL_TEMPLATE_DIR=templates/email

# =============================================================================
# OAUTH CONFIGURATION (Optional)
# =============================================================================
# Google OAuth (optional)
# GOOGLE_CLIENT_ID=your_google_client_id
# GOOGLE_CLIENT_SECRET=your_google_client_secret
# GOOGLE_REDIRECT_URI=https://yourdomain.com/auth/callback/google

# GitHub OAuth (optional)
# GITHUB_CLIENT_ID=your_github_client_id
# GITHUB_CLIENT_SECRET=your_github_client_secret
# GITHUB_REDIRECT_URI=https://yourdomain.com/auth/callback/github

# OAuth state token expiration in minutes
# OAUTH_STATE_EXPIRES_MINUTES=10

# =============================================================================
# WEBAUTHN/PASSKEY CONFIGURATION (Optional)
# =============================================================================
# WebAuthn relying party configuration
# WEBAUTHN_RP_ID=yourdomain.com
# WEBAUTHN_RP_NAME=Your App Name
# WEBAUTHN_RP_ORIGIN=https://yourdomain.com
# WEBAUTHN_REQUIRE_RESIDENT_KEY=false
# WEBAUTHN_USER_VERIFICATION=preferred
# WEBAUTHN_AUTHENTICATOR_ATTACHMENT=platform

# =============================================================================
# ALERT DESTINATIONS (Optional)
# =============================================================================
# Email alerts
# ALERT_EMAIL_ENABLED=true
# ALERT_EMAIL_RECIPIENTS=security@yourdomain.com,admin@yourdomain.com

# Webhook alerts
# ALERT_WEBHOOK_ENABLED=true
# ALERT_WEBHOOK_URL=https://your-monitoring-system.com/webhooks/security
# ALERT_WEBHOOK_TIMEOUT=30

# Slack alerts
# ALERT_SLACK_ENABLED=true
# ALERT_SLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK
# ALERT_SLACK_CHANNEL=#security-alerts
# ALERT_SLACK_USERNAME=Security Bot

# =============================================================================
# DEVELOPMENT/TESTING CONFIGURATION
# =============================================================================
# Only use these settings in development/testing environments
# NEVER use in production!

# Disable security features for development (NOT RECOMMENDED)
# DEV_DISABLE_RATE_LIMITING=false
# DEV_DISABLE_AUDIT_LOGGING=false
# DEV_DISABLE_SECURITY_HEADERS=false
# DEV_ALLOW_HTTP=false

# Test mode settings
# TEST_MODE=false
# TEST_SKIP_EMAIL_VERIFICATION=false
# TEST_BYPASS_RATE_LIMITS=false

# =============================================================================
# SECURITY BEST PRACTICES
# =============================================================================
# 1. Always use strong, unique secrets for JWT tokens
# 2. Enable HTTPS in production (AUTH_REQUIRE_HTTPS=true)
# 3. Configure appropriate rate limits based on your traffic patterns
# 4. Monitor audit logs regularly for suspicious activity
# 5. Set up alerts for security events
# 6. Keep audit logs for compliance requirements (90+ days recommended)
# 7. Use secure cookie settings in production
# 8. Configure CSP headers appropriately for your frontend
# 9. Regular security audits and penetration testing
# 10. Monitor for password field attempts (AUTH_ALERT_ON_PASSWORD_ATTEMPTS=true)

# =============================================================================
# PRODUCTION DEPLOYMENT CHECKLIST
# =============================================================================
# □ All secrets are generated with cryptographically secure random generators
# □ HTTPS is enabled and HTTP is redirected
# □ Rate limiting is enabled with appropriate thresholds
# □ Audit logging is enabled with secure storage
# □ Security headers are configured correctly
# □ CORS origins are set to specific domains (not *)
# □ Password field rejection is enabled
# □ Security alerts are configured and tested
# □ Database connections are secured with SSL
# □ Environment variables are properly secured
# □ Monitoring and alerting systems are in place
# □ Backup and recovery procedures are tested
# □ Security incident response plan is documented
